jQuery.fn.extend({captify_reload:function(){$(this).each(function(){$('.caption-wrapper').css('height',$(this).height());$('.caption').css('width',$(this).width());});},captify:function(o){var o=$.extend({speedOver:'fast',speedOut:'normal',hideDelay:500,animation:'fade',prefix:'',className:'caption'},o);$(this).each(function(){var img=this;$(this).load(function(){$this=img;if(this.hasInit){$(img).trigger('load');return false;}this.hasInit=true;var over_caption=false;var over_img=false;var captionLabelSrc=$('#'+$(this).attr('rel'));var captionLabelTitle=!captionLabelSrc.length?$(this).attr('title'):captionLabelSrc.html();var captionLabelHTML=!captionLabelTitle.length?$(this).attr('alt'):captionLabelTitle;captionLabelSrc.remove();var toWrap=this.parent&&this.parent.tagName=='a'?this.parent:$(this);var wrapper=toWrap.wrap('<div></div>').parent();wrapper.css({overflow:'hidden',padding:0,fontSize:0.1})
wrapper.addClass('caption-wrapper');wrapper.width("100%");wrapper.height($(this).height());$.map(['top','right','bottom','left'],function(i){$.map(['style','width','color'],function(j){var key='border-'+i+'-'+j;wrapper.css(key,$(img).css(key));});});$(img).css({border:'0 none'});$.map(['top','right','bottom','left'],function(t){var key='margin-'+t;wrapper.css(key,$(img).css(key));});var caption=$('div:last',wrapper.append('<div></div>')).addClass(o.className);var captionContent=$('div:last',wrapper.append('<div></div>')).addClass(o.className+" caption_content").append(o.prefix).append(captionLabelHTML);var captionContent_resp=$('div:last',wrapper.append('<div></div>')).addClass(o.className+"_resp").append(o.prefix).append(captionLabelHTML);$('*',wrapper).css({margin:0}).show();var captionPositioning=jQuery.browser.msie?'static':'relative';caption.css({zIndex:1,position:captionPositioning});captionContent.css({position:captionPositioning,zIndex:2,background:'none',border:'0 none',opacity:1.0});caption.width("100%");caption.height("48px");captionContent.css({'marginTop':-caption.outerHeight()});var cHide=function(){if(!over_caption&&!over_img)caption.animate({marginTop:0},o.speedOut);};$(this).hover(function(){over_img=true;if(!over_caption){caption.animate({marginTop:-caption.height()},o.speedOver);}},function(){over_img=false;window.setTimeout(cHide,o.hideDelay);});$('div',wrapper).hover(function(){over_caption=true;},function(){over_caption=false;window.setTimeout(cHide,o.hideDelay);});});if(this.complete||this.naturalWidth>0){$(img).trigger('load');}});}});