/* repo: amd-modules/release-coresite-GDPR-update-1.3@2.5.1-5-g448ecbf - Package Version: 2.5.2 - 2018-09-18 03:39 pm - User:  */

define("webmd.gdpr/1/webmd.gdpr",["css!webmd.gdpr/1/webmd.gdpr.css"],function(){"use strict";return webmd.gdpr={constants:{cookie:{name:"gdpreu"},country:"",geoTargetCookieName:"gtinfo",testing:!1,parentPageName:""},defaults:{apiUrl:"/api/directories/service.svc/location/Europe",bannerClass:"eugdpr-banner",bannerPosition:"top",buttonHTML:'<button class="eugdpr-consent-button" data-js="gdpr-consent">I AGREE</button>',overlayClass:"eugdpr-overlay",consentCallback:function(){},messageHTML:'<p>WebMD processes personal data about users of our site, including health data, through the use of cookies to deliver our services, personalize advertising and to analyze site activity. We may share certain information about our users with our advertising and analytics partners. For additional details, refer to the <a data-js="gdpr-policy">WebMD Privacy Policy</a>.</p><p>By clicking "I AGREE" below, you agree to the <a data-js="gdpr-policy">WebMD Privacy Policy</a> and WebMDâ€™s personal data processing and cookie practices as described therein.</p>',policyUrl:"https://www{lifecycle}{env}.webmd.com/about-webmd-policies/about-privacy-policy",policyContentSelector:"article",metrics:{moduleName:"gdpr",moduleLink:{button:"accept",policy:"privacy"}},cookie:{name:"gdpreu",options:{domain:webmd.url.getSLD()||window.location.hostname,expires:3650},state:{consent:"CONSENTED",noConsent:"NOTIN"},template:"{group}|{country}|{state}|{timestamp}"}},settings:{},init:function(config){var _this=this,apiUrl="";return _this.settings=$.extend({},_this.defaults,config),apiUrl=_this.formatApiEndpoint(_this.settings.apiUrl),!_this.hasCookie(_this.constants.cookie.name)&&(_this.constants.parentPageName=window.s_md.pageName||window.s_pagename,$(window).on("webmd.gdpr.alertNeeded",function(event,userLocation){_this.isAlertNeeded(userLocation)}),$(window).on("webmd.gdpr.display",function(){_this.display()}),$(window).on("webmd.gdpr.displayComplete",function(){setTimeout(function(){window.scrollTo({top:0,left:0,behavior:"instant"})},50)}),$(window).on("webmd.gdpr.consent",function(){window.gdprStopPV&&webmd.metrics.dpv({refresh:!1})}),_this.isTesting()&&(_this.constants.testing=!0),_this.getLocation(apiUrl,_this.constants.geoTargetCookieName),void $(window).trigger("webmd.gdpr.init",[_this]))},createBannerElement:function(){var _this=this,$el=$("<div></div>"),classString=_this.settings.bannerClass+" eugdpr--hide"+(_this.settings.addBannerClass?" "+_this.settings.addBannerClass:"");switch(_this.settings.bannerPosition){case"center":classString+=" center";break;case"bottom":classString+=" bottom";break;case"cover":classString+=" cover";break;default:classString+=" top"}0===$("."+_this.settings.bannerClass).length&&($el.addClass(classString).html(_this.settings.messageHTML.concat(_this.settings.buttonHTML)),$("body").prepend($el))},createOverlayElement:function(){var _this=this,$el=$("<div></div>"),classString=_this.settings.overlayClass+" eugdpr--hide"+(_this.settings.addOverlayClass?" "+_this.settings.addOverlayClass:"");0===$("."+_this.settings.overlayClass).length&&($el.addClass(classString),$("body").prepend($el))},createPolicyOverlay:function(){var _this=this,$el=$('<div id="gdpr-policy-overlay"><div class="close" id="gdpr-policy-close">close</div><div class="content"><div class="loading"><p>Loading...</p></div></div></div>'),errorHtml="<p>There was an error retrieving the Privacy Policy.</p><p>Please contact Cusomter Service to receive a copy of our Privacy Policy at: https://customercare.webmd.com/hc/en-us</p>",policyLink=webmd.substitute(_this.settings.policyUrl,{lifecycle:webmd.url.getLifecycle(),env:webmd.url.getEnv()}),policySelector="#gdpr-policy-overlay",pg=window.location.host;webmd.metrics.dpv({pageName:pg.concat("/",_this.settings.metrics.moduleName,"-privacy-policy"),refresh:!1}),window.s_md.pageName=_this.constants.parentPageName,0===$(policySelector).length&&($("body").prepend($el),$(policySelector+" .content").load(policyLink+" "+_this.settings.policyContentSelector,function(response,status){"success"===status?$(policySelector+" .content").find(".loading").remove():$(policySelector+" .content").html(errorHtml)}));try{$(policySelector).on("click",".close",function(event){$(event.delegateTarget).remove()})}catch(e){webmd.debug("Exception in the policy overlay close handler")}},getLocation:function(api,geoCookie){var _this=this,userData={},location={};return _this.constants.testing&&_this.constants.country?("string"==typeof _this.constants.country?(location.alpha3country=_this.constants.country.toLowerCase(),location.alpha2country=_this.constants.country.toLowerCase()):"number"==typeof _this.constants.country&&(location.countrycode=parseInt(_this.constants.country,10)),$(window).trigger("webmd.gdpr.alertNeeded",location),!1):void(_this.hasCookie(geoCookie)?(userData=webmd.cookie.get(geoCookie),webmd.debug("RT Cookie is present"),"string"==typeof userData&&(userData=JSON.parse(userData)),location.alpha3country=userData.cntr||"",location.countrycode=parseInt(userData.cntrc,10)||0,$(window).trigger("webmd.gdpr.alertNeeded",location)):$.get(api).done(function(data){data?("string"==typeof data&&(data=JSON.parse(data)),userData=data.data,"string"==typeof userData&&(userData=JSON.parse(userData)),location.alpha3country=userData.edgecountry||"",location.alpha2country=userData.edgetwolettercountry||"",location.countrycode=parseInt(userData.edgecountrycode,10)||0,$(window).trigger("webmd.gdpr.alertNeeded",location)):(webmd.debug("ERROR: API malformed in webmd.gdpr :: getLocation"),$(window).trigger("webmd.gdpr.display"))}).fail(function(){webmd.debug("ERROR: API failure in webmd.gdpr :: getLocation"),$(window).trigger("webmd.gdpr.display")}))},formatApiEndpoint:function(api){var env=webmd.url.getEnv()||"",lifecycle=webmd.url.getLifecycle()||"",sld=webmd.url.getSLD()||"webmd.com",protocol=window.location.protocol;return 0!==api.indexOf("http")&&0!==api.indexOf("//")&&("/"!==api.charAt(0)&&(api="".concat("/",api)),api=protocol.concat("//www",lifecycle,env,".",sld,api)),api},bindClickEvents:function(){var _this=this;try{$("body").on("click",'[data-js="gdpr-policy"]',function(event){_this.handlePolicyClick(event)}),$("body").on("click",'[data-js="gdpr-consent"]',function(event){_this.handleConsent(event)})}catch(e){webmd.debug("Exception hit inside webmd.gdpr.bindClickEvents")}},hasCookie:function(cookieName){return webmd.cookie.exists(cookieName)},setCookie:function(cookieName,group,country,state){var _this=this,data={},timestamp=Math.round((new Date).getTime()/1e3);data=webmd.substitute(_this.settings.cookie.template,{group:group,country:country,state:state,timestamp:timestamp}),webmd.cookie.set(cookieName,data,_this.settings.cookie.options)},handleConsent:function(){var _this=this;_this.setCookie(_this.constants.cookie.name,"eu",_this.constants.country,_this.settings.cookie.state.consent),$("."+_this.settings.bannerClass).remove(),$("."+_this.settings.overlayClass).remove(),$("body").removeAttr("data-content-masked"),$("html, body").removeClass("eugdpr-disabled"),window.gdprStopPV?window.wmdTrack(_this.settings.metrics.moduleName.concat("-",_this.settings.metrics.moduleLink.button)):(window.s_md.pageName=window.location.host.concat("/",_this.settings.metrics.moduleName,"-roadblock"),window.wmdPageLink(_this.settings.metrics.moduleName.concat("-",_this.settings.metrics.moduleLink.button)),window.s_md.pageName=_this.constants.parentPageName),window.ibtracker=window.ibtracker||[],window.ibtracker.push(["GDPRAcceptance",{eventText:event.target.innerHTML}]),_this.settings.consentCallback(),$(window).trigger("webmd.gdpr.consent",[_this])},handlePolicyClick:function(){var _this=this;window.wmdTrack(_this.settings.metrics.moduleName.concat("-",_this.settings.metrics.moduleLink.policy)),_this.createPolicyOverlay()},display:function(){var _this=this,pg=window.location.host;$("body").attr("data-content-masked",!0),_this.createBannerElement(),_this.createOverlayElement(),_this.bindClickEvents(),$(".eugdpr--hide").removeClass("eugdpr--hide"),$("html, body").addClass("eugdpr-disabled"),webmd.metrics.dpv({pageName:pg.concat("/",_this.settings.metrics.moduleName,"-roadblock"),refresh:!1}),window.s_md.pageName=_this.constants.parentPageName,$(window).trigger("webmd.gdpr.displayComplete",[_this])},isAlertNeeded:function(location){var _this=this,country="",match=!1,i=0,jsonData=webmd.gdpr.data_eu;if(location&&(location.alpha3country||location.countrycode>0))try{if(jsonData)for(i;i<jsonData.length;i++){if(country=jsonData[i],location.alpha3country&&country.edgecountry.toLowerCase()===location.alpha3country.toLowerCase()){location.country=location.alpha3country.toUpperCase(),match=!0;break}if(location.alpha2country&&country.edgetwolettercountry.toLowerCase()===location.alpha2country.toLowerCase()){location.country=location.alpha2country.toUpperCase(),match=!0;break}if(location.countrycode&&location.countrycode>0&&parseInt(country.countrycode,10)===parseInt(location.countrycode,10)){location.country=country.edgecountry.toUpperCase(),match=!0;break}if(location.alpha3country&&"**"===location.alpha3country.toLowerCase()){match=!0;break}location.country=location.alpha3country.toUpperCase()}if(match)return $(window).trigger("webmd.gdpr.display"),!0;_this.setCookie(_this.constants.cookie.name,"eu",location.country,_this.settings.cookie.state.noConsent),$(window).trigger("webmd.gdpr.consent")}catch(e){webmd.debug("Error retrieving json file for webmd.gdpr.isAlertNeeded")}else $(window).trigger("webmd.gdpr.display");return!1},isTesting:function(){var _this=this,env=webmd.url.getEnv()||"",lifecycle=webmd.url.getLifecycle()||"",query=webmd.url.getParams()||{},position=query.gdprposition,location=query.gdprlocation;return!(!position&&!location||!lifecycle&&!env)&&(position&&(_this.settings.bannerPosition=position[0]||_this.settings.bannerPosition),location&&(_this.constants.country=location[0]||_this.constants.country),!0)}},webmd.gdpr.data_eu=[{country:"Ascension Island",edgetwolettercountry:"AC",edgecountry:"",edgecountrycode:"0"},{country:"Canary Islands",edgetwolettercountry:"IC",edgecountry:"",edgecountrycode:"0"},{country:"Moldova, Republic Of",edgetwolettercountry:"MD",edgecountry:"MDA",edgecountrycode:"498"},{country:"Faroe Islands",edgetwolettercountry:"FO",edgecountry:"FRO",edgecountrycode:"234"},{country:"Guernsey",edgetwolettercountry:"GG",edgecountry:"GGY",edgecountrycode:"0"},{country:"Jersey",edgetwolettercountry:"JE",edgecountry:"JEY",edgecountrycode:"0"},{country:"Macedonia",edgetwolettercountry:"MK",edgecountry:"MKD",edgecountrycode:"807"},{country:"Holy See (Vatican City State)",edgetwolettercountry:"VA",edgecountry:"VAT",edgecountrycode:"336"},{country:"Bulgaria",edgetwolettercountry:"BG",edgecountry:"BGR",edgecountrycode:"100"},{country:"Belarus",edgetwolettercountry:"BY",edgecountry:"BLR",edgecountrycode:"112"},{country:"Czech Republic",edgetwolettercountry:"CZ",edgecountry:"CZE",edgecountrycode:"203"},{country:"Hungary",edgetwolettercountry:"HU",edgecountry:"HUN",edgecountrycode:"348"},{country:"Poland",edgetwolettercountry:"PL",edgecountry:"POL",edgecountrycode:"616"},{country:"Romania",edgetwolettercountry:"RO",edgecountry:"ROU",edgecountrycode:"642"},{country:"Russian Federation",edgetwolettercountry:"RU",edgecountry:"RUS",edgecountrycode:"643"},{country:"Slovakia",edgetwolettercountry:"SK",edgecountry:"SVK",edgecountrycode:"703"},{country:"Ukraine",edgetwolettercountry:"UA",edgecountry:"UKR",edgecountrycode:"804"},{country:"Aland Islands",edgetwolettercountry:"AX",edgecountry:"ALA",edgecountrycode:"248"},{country:"Denmark",edgetwolettercountry:"DK",edgecountry:"DNK",edgecountrycode:"208"},{country:"Estonia",edgetwolettercountry:"EE",edgecountry:"EST",edgecountrycode:"233"},{country:"Finland",edgetwolettercountry:"FI",edgecountry:"FIN",edgecountrycode:"246"},{country:"United Kingdom",edgetwolettercountry:"GB",edgecountry:"GBR",edgecountrycode:"826"},{country:"Ireland",edgetwolettercountry:"IE",edgecountry:"IRL",edgecountrycode:"372"},{country:"Isle of Man",edgetwolettercountry:"IM",edgecountry:"IMN",edgecountrycode:"833"},{country:"Iceland",edgetwolettercountry:"IS",edgecountry:"ISL",edgecountrycode:"352"},{country:"Lithuania",edgetwolettercountry:"LT",edgecountry:"LTU",edgecountrycode:"440"},{country:"Latvia",edgetwolettercountry:"LV",edgecountry:"LVA",edgecountrycode:"428"},{country:"Norway",edgetwolettercountry:"NO",edgecountry:"NOR",edgecountrycode:"578"},{country:"Sweden",edgetwolettercountry:"SE",edgecountry:"SWE",edgecountrycode:"752"},{country:"Andorra",edgetwolettercountry:"AD",edgecountry:"AND",edgecountrycode:"20"},{country:"Albania",edgetwolettercountry:"AL",edgecountry:"ALB",edgecountrycode:"8"},{country:"Bosnia and Herzegovina",edgetwolettercountry:"BA",edgecountry:"BIH",edgecountrycode:"70"},{country:"Spain",edgetwolettercountry:"ES",edgecountry:"ESP",edgecountrycode:"724"},{country:"Gibraltar",edgetwolettercountry:"GI",edgecountry:"GIB",edgecountrycode:"292"},{country:"Greece",edgetwolettercountry:"GR",edgecountry:"GRC",edgecountrycode:"300"},{country:"Croatia",edgetwolettercountry:"HR",edgecountry:"HRV",edgecountrycode:"191"},{country:"Italy",edgetwolettercountry:"IT",edgecountry:"ITA",edgecountrycode:"380"},{country:"Montenegro",edgetwolettercountry:"ME",edgecountry:"MNE",edgecountrycode:"499"},{country:"Malta",edgetwolettercountry:"MT",edgecountry:"MLT",edgecountrycode:"470"},{country:"Portugal",edgetwolettercountry:"PT",edgecountry:"PRT",edgecountrycode:"620"},{country:"Serbia",edgetwolettercountry:"RS",edgecountry:"SRB",edgecountrycode:"688"},{country:"Slovenia",edgetwolettercountry:"SI",edgecountry:"SVN",edgecountrycode:"705"},{country:"San Marino",edgetwolettercountry:"SM",edgecountry:"SMR",edgecountrycode:"674"},{country:"Yugoslavia",edgetwolettercountry:"YU",edgecountry:"YUG",edgecountrycode:"890"},{country:"Austria",edgetwolettercountry:"AT",edgecountry:"AUT",edgecountrycode:"40"},{country:"Belgium",edgetwolettercountry:"BE",edgecountry:"BEL",edgecountrycode:"56"},{country:"Switzerland",edgetwolettercountry:"CH",edgecountry:"CHE",edgecountrycode:"756"},{country:"Germany",edgetwolettercountry:"DE",edgecountry:"DEU",edgecountrycode:"276"},{country:"France",edgetwolettercountry:"FR",edgecountry:"FRA",edgecountrycode:"250"},{country:"Liechtenstein",edgetwolettercountry:"LI",edgecountry:"LIE",edgecountrycode:"438"},{country:"Luxembourg",edgetwolettercountry:"LU",edgecountry:"LUX",edgecountrycode:"442"},{country:"Monaco",edgetwolettercountry:"MC",edgecountry:"MCO",edgecountrycode:"492"},{country:"Netherlands",edgetwolettercountry:"NL",edgecountry:"NLD",edgecountrycode:"528"}],webmd.gdpr});